name: "Transifex Push"

on:
  workflow_call:
    secrets:
      tx_token:
        required: true
    inputs:
      branch:
        required: false
        default: 'main'
        type: 'string'

jobs:
  ci:
    name: "Translations"
    runs-on: ubuntu-latest
    container:
      image: "ghcr.io/glpi-project/plugin-builder"
    steps:

    ##########################################
    # Checkout repository                    #
    ##########################################
    - name: "Checkout"
      uses: actions/checkout@v4
      with:
        ref: ${{ inputs.branch }}

    ##########################################
    # Install depdendencies                  #
    ##########################################
    - name: Install Dependencies
      run: |
        composer install --no-progress --no-suggest --no-interaction --prefer-dist

    ##########################################
    # Generate <plugin>.pot file             #
    ##########################################
    - name: "Generate <plugin>.pot file"
      run: ./vendor/bin/extract-locales


    ##########################################
    # Push transifiex source puglin.pot #
    ##########################################
    - name: Push source file (.pot)
      uses: transifex/cli-action@v2
      with:
        args: push
        token: ${{ secrets.tx_token }}
